# docker-services

### Описание проекта

Данный проект разворачивает локальную среду разработки на Docker контейнерах. В проект включены сервисы для совместного 
использования несколькими Laravel приложениями. Докер контейнеры для приложений разворачиваются отдельно для каждого 
приложения. Смотри репозиторий [тут](https://github.com/acwstudio/docker-laravel)


Если возникнет желание использовать **docker-services** на реальном VPS с приложениями в общем доступе, 
добавлен сервис **Certbot** для генерации реальных SSL-сертификатов

Проект предлагает расширяемый набор сервисов:

- Прокси сервер Nginx локальный
- Прокси сервер Nginx для удаленного сервера
- Certbot (в одном контейнере с прокси сервером для удаленного сервера)
- MySQL 8
- MySQL 5.7
- MailHog

**Прокси сервер** локальный

Запускается в отдельном контейнере. Не может существовать одновременно с **Прокси сервером** для 
удаленного сервера (оба используют одни и те же порты)

- обеспечивает **external network** для коммуникации с контейнерами, не принадлежащими внутренней сети
- имеет свой центр сертификации локальных доменов для генерации локально доверенных сертификатов
- слушает порт **80** для **http** и перенаправляет запросы на порт **443** для проверки SSL-сертификатов
- слушает порт **443** для **https**, проверяет SSL-сертификаты и транслирует запрос на соответствующие 
сайты и приложения, находящиеся за **прокси сервером**.

Для создания локально доверенных SSL-сертификатов необходимо на хосте иметь установленную утилиту 
`Mkcert`. Далее создать конфигурационный файл `reverse-proxy/.env.ssl` и запустить скрипт 
`init-mkcert.sh`

Таким образом, к каждому приложению можно обращаться по назначенному ему локальному домену и имитировать 
проверку SSL сертификата, что делает среду разработки максимально идентичной среде на удаленном сервере.

**Прокси сервер** для удаленного сервера

Запускается в отдельном контейнере. Не может существовать одновременно с **Прокси сервером** для 
локального сервера (оба используют одни и те же порты)

- обеспечивает **external network** для коммуникации с контейнерами, не принадлежащими внутренней сети
- получает и обновляет бесплатные SSL-сертификаты от центра сертификации **Let's Encrypt**
- слушает порт **80** для **http** и перенаправляет запросы на порт **443** для проверки SSL-сертификатов
- слушает порт **443** для **https**, проверяет SSL-сертификаты и транслирует запрос на соответствующие 
сайты и приложения, находящиеся за **прокси сервером**.

Таким образом, возможно иметь несколько доменов на одном VPS.

**Certbot** ACME клиент автоматически создает и устанавливает сертификаты

Запускается в одном контейнере с **Nginx прокси сервером** для удаленного сервера и предназначен только 
для получения SSL-сертификатовтдля реальных доменов.

Получает и устанавливает бесплатные SSL-сертификаты от центра сертификации **Let's Encrypt**. Для получения 
SSL-сертификатов необходимо создать конфигурационный файл `reverse-proxy-remote/.env.ssl` и запустить 
скрипт `init-letsencrypt.sh`

**MySQL 8** и **MySQL 5.7** система управления базами данных

Запускаются каждая в отдельном контейнере

- обеспечивает **external network** для коммуникации с контейнерами, не принадлежащими внутренней сети
- обеспечивает на локалном компьютере наличие **volumes** для настройки конфигурации и сохранения на 
диске данных, в случае перезапуска контейнера
- создает, служебные базы данных, пользователя **root** и пароль для него
- создание пользовательских баз данных, пользователей и паролей к ним, не входит в обязанности сервиса и 
создаются по мере их необходимости для конкретных приложений штатными способами MySQL

**MailHog** инструмент для тестирования **email**

Запускается в отдельном контейнере

- обеспечивает **external network** для коммуникации с контейнерами, не принадлежащими внутренней сети
- предоставляет локальный **SMPT** сервер с веб интерфейсом

**Примечания**

Для удобства работы с сервисами в файле **Makefile** создан набор коротких команд управления.

Каждый сервис запускается отдельно, что позволяет запустить только необходимое.

По аналогии с уже существующими сервисами можно добавлять или удалять любые сервисы под свои нужды, 
редактировать существующие и соответственно создавать свои команды в **Makefile** или написать свои 
**bash scripts**.

Каждый сервис предназначен для использования несколькими приложениями. Но существуют сервисы, которые 
должны работать только со своим приложением, т.к. завязаны непосредственно на файлы приложения. Например 
**веб сервер**, **php-fpm**, **node.js**. Для такого случая, применительно к **Laravel** есть проект 
**docker-laravel** репозиторий которого [тут](https://github.com/acwstudio/docker-laravel)
